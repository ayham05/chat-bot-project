'use client';

import { useState } from 'react';
import Link from 'next/link';
import { ArrowLeft, ExternalLink, Maximize2, Minimize2, AlertTriangle } from 'lucide-react';
import ChatBot from '@/components/ChatBot';

const TINKERCAD_BASE = 'https://www.tinkercad.com';

// Each project has an optional embedId for the Tinkercad /embed/ URL.
// To get your embed ID:
//   1. Open the project on tinkercad.com
//   2. Click "Share" â†’ copy the embed URL
//   3. The ID is the part after /things/ (e.g. "abc123xyz")
// If embedId is empty, only a direct link is shown (no iframe).
const projects = [
    {
        id: 'blink',
        title: 'LED ÙˆØ§Ù…Ø¶',
        title_en: 'Blinking LED',
        description: 'ØªØ¹Ù„Ù… ÙƒÙŠÙÙŠØ© ØªÙˆØµÙŠÙ„ LED ÙˆØ¬Ø¹Ù„Ù‡ ÙŠÙˆÙ…Ø¶',
        difficulty: 'Ù…Ø¨ØªØ¯Ø¦',
        // Replace with your actual Tinkercad embed ID
        embedId: '',
        tinkercadUrl: `${TINKERCAD_BASE}/circuits`,
    },
    {
        id: 'traffic',
        title: 'Ø¥Ø´Ø§Ø±Ø© Ù…Ø±ÙˆØ±',
        title_en: 'Traffic Light',
        description: 'Ø£Ù†Ø´Ø¦ Ø¥Ø´Ø§Ø±Ø© Ù…Ø±ÙˆØ± Ø¨Ø«Ù„Ø§Ø«Ø© Ø£Ù„ÙˆØ§Ù†',
        difficulty: 'Ù…Ø¨ØªØ¯Ø¦',
        embedId: '',
        tinkercadUrl: `${TINKERCAD_BASE}/circuits`,
    },
    {
        id: 'sensor',
        title: 'Ù…Ø³ØªØ´Ø¹Ø± Ø§Ù„Ù…Ø³Ø§ÙØ©',
        title_en: 'Distance Sensor',
        description: 'Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø³ØªØ´Ø¹Ø± Ø§Ù„Ù…ÙˆØ¬Ø§Øª ÙÙˆÙ‚ Ø§Ù„ØµÙˆØªÙŠØ© Ù„Ù‚ÙŠØ§Ø³ Ø§Ù„Ù…Ø³Ø§ÙØ©',
        difficulty: 'Ù…ØªÙˆØ³Ø·',
        embedId: '',
        tinkercadUrl: `${TINKERCAD_BASE}/circuits`,
    },
    {
        id: 'servo',
        title: 'Ù…Ø­Ø±Ùƒ Ø³ÙŠØ±ÙÙˆ',
        title_en: 'Servo Motor',
        description: 'ØªØ­ÙƒÙ… ÙÙŠ Ø²Ø§ÙˆÙŠØ© Ù…Ø­Ø±Ùƒ Ø§Ù„Ø³ÙŠØ±ÙÙˆ',
        difficulty: 'Ù…ØªÙˆØ³Ø·',
        embedId: '',
        tinkercadUrl: `${TINKERCAD_BASE}/circuits`,
    },
];

export default function RoboticsPage() {
    const [isFullscreen, setIsFullscreen] = useState(false);
    const [currentProjectId, setCurrentProjectId] = useState('');
    const [embedError, setEmbedError] = useState(false);

    const currentProject = projects.find((p) => p.id === currentProjectId);

    // Build the embed URL if the project has an embedId
    const getEmbedUrl = (project: typeof projects[0]) => {
        if (!project.embedId) return null;
        return `${TINKERCAD_BASE}/embed/${project.embedId}?editbtn=1`;
    };

    const embedUrl = currentProject ? getEmbedUrl(currentProject) : null;

    return (
        <div className="min-h-screen flex flex-col">
            {/* Header */}
            <div className="glass-dark border-b border-white/10 px-4 py-3">
                <div className="max-w-[1800px] mx-auto flex items-center justify-between">
                    <div className="flex items-center gap-4">
                        <Link
                            href="/"
                            className="flex items-center gap-2 text-white/60 hover:text-white transition-colors"
                        >
                            <ArrowLeft className="w-4 h-4" />
                            <span>Ø§Ù„Ø¹ÙˆØ¯Ø©</span>
                        </Link>
                        <span className="text-white/30">|</span>
                        <h1 className="font-semibold">Ù…Ø¹Ù…Ù„ Ø§Ù„Ø±ÙˆØ¨ÙˆØªØ§Øª</h1>
                    </div>
                    <div className="flex items-center gap-2">
                        <a
                            href={`${TINKERCAD_BASE}/circuits`}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="btn-secondary text-sm py-2 flex items-center gap-2"
                        >
                            <ExternalLink className="w-4 h-4" />
                            <span>ÙØªØ­ Tinkercad</span>
                        </a>
                        <button
                            onClick={() => setIsFullscreen(!isFullscreen)}
                            className="btn-secondary text-sm py-2 px-3"
                        >
                            {isFullscreen ? (
                                <Minimize2 className="w-4 h-4" />
                            ) : (
                                <Maximize2 className="w-4 h-4" />
                            )}
                        </button>
                    </div>
                </div>
            </div>

            {/* Main Content */}
            <div className={`flex flex-1 ${isFullscreen ? '' : 'h-[calc(100vh-8rem)]'}`}>
                {/* Projects Sidebar */}
                {!isFullscreen && (
                    <div className="w-64 border-l border-white/10 glass-dark overflow-y-auto">
                        <div className="p-4">
                            <h2 className="font-semibold mb-4">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h2>
                            <div className="space-y-2">
                                {projects.map((project) => (
                                    <button
                                        key={project.id}
                                        onClick={() => {
                                            setCurrentProjectId(project.id);
                                            setEmbedError(false);
                                        }}
                                        className={`w-full p-3 rounded-xl text-right transition-all ${currentProjectId === project.id
                                            ? 'bg-accent-500/20 border border-accent-500/30'
                                            : 'bg-white/5 hover:bg-white/10 border border-transparent'
                                            }`}
                                    >
                                        <h3 className="font-medium text-sm">{project.title}</h3>
                                        <p className="text-xs text-white/60 mt-1">{project.title_en}</p>
                                        <span className="text-xs text-accent-400 mt-2 inline-block">
                                            {project.difficulty}
                                        </span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                )}

                {/* Tinkercad Content Area */}
                <div className="flex-1 flex flex-col">
                    <div className="flex-1 relative bg-slate-900">
                        {/* Show embed if project has an embedId */}
                        {currentProject && embedUrl && !embedError ? (
                            <iframe
                                src={embedUrl}
                                className="w-full h-full border-0"
                                title={`Tinkercad - ${currentProject.title_en}`}
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowFullScreen
                                onError={() => setEmbedError(true)}
                            />
                        ) : currentProject ? (
                            /* Fallback: no embed available or embed failed */
                            <div className="absolute inset-0 flex items-center justify-center">
                                <div className="text-center max-w-lg p-8">
                                    <div className="w-20 h-20 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-accent-500/20 to-blue-500/20 flex items-center justify-center">
                                        <span className="text-4xl">ğŸ”§</span>
                                    </div>
                                    <h2 className="text-2xl font-bold mb-2">
                                        {currentProject.title}
                                    </h2>
                                    <p className="text-lg text-white/70 mb-1">
                                        {currentProject.title_en}
                                    </p>
                                    <p className="text-white/50 mb-6">
                                        {currentProject.description}
                                    </p>

                                    {embedError && (
                                        <div className="flex items-center gap-2 text-yellow-400/80 text-sm mb-4 justify-center">
                                            <AlertTriangle className="w-4 h-4" />
                                            <span>Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ø¨Ø§Ø´Ø±Ø© â€” ÙŠØ±Ø¬Ù‰ ÙØªØ­Ù‡ ÙÙŠ Tinkercad</span>
                                        </div>
                                    )}

                                    {!currentProject.embedId && (
                                        <div className="bg-white/5 rounded-xl p-4 mb-6 text-sm text-white/60 text-right leading-relaxed">
                                            <p className="mb-2">
                                                <strong className="text-white/80">ğŸ’¡ Ù„ØªØ¶Ù…ÙŠÙ† Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</strong>
                                            </p>
                                            <ol className="list-decimal list-inside space-y-1">
                                                <li>Ø§ÙØªØ­ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙÙŠ Tinkercad</li>
                                                <li>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ &quot;Share&quot; â† Ø«Ù… Ø§Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ¶Ù…ÙŠÙ† (Embed)</li>
                                                <li>Ø£Ø¶Ù Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯</li>
                                            </ol>
                                        </div>
                                    )}

                                    <a
                                        href={currentProject.tinkercadUrl}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        className="btn-primary inline-flex items-center gap-2 text-lg px-8 py-3"
                                    >
                                        <ExternalLink className="w-5 h-5" />
                                        ÙØªØ­ ÙÙŠ Tinkercad
                                    </a>
                                </div>
                            </div>
                        ) : (
                            /* No project selected */
                            <div className="absolute inset-0 bg-slate-900/90 flex items-center justify-center">
                                <div className="text-center max-w-md p-8">
                                    <div className="text-6xl mb-4">ğŸ¤–</div>
                                    <h2 className="text-2xl font-bold mb-4">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø¹Ù…Ù„ Ø§Ù„Ø±ÙˆØ¨ÙˆØªØ§Øª!</h2>
                                    <p className="text-white/60 mb-6">
                                        Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ù„Ø¨Ø¯Ø¡ØŒ Ø£Ùˆ Ø§ÙØªØ­ Tinkercad Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯.
                                    </p>
                                    <div className="flex gap-4 justify-center">
                                        <button
                                            onClick={() => {
                                                setCurrentProjectId('blink');
                                                setEmbedError(false);
                                            }}
                                            className="btn-primary"
                                        >
                                            Ø§Ø¨Ø¯Ø£ Ø£ÙˆÙ„ Ù…Ø´Ø±ÙˆØ¹
                                        </button>
                                        <a
                                            href={`${TINKERCAD_BASE}/circuits`}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="btn-secondary flex items-center gap-2"
                                        >
                                            <ExternalLink className="w-4 h-4" />
                                            Tinkercad
                                        </a>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>

                {/* Chat Panel */}
                {!isFullscreen && (
                    <div className="w-96 border-r border-white/10">
                        <ChatBot track="robotics" />
                    </div>
                )}
            </div>
        </div>
    );
}
